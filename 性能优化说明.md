# 性能优化说明

## 图片大小限制

### 问题
当关键词数量过多时，生成的热力图会非常大，可能导致：
- 内存溢出错误
- 图片加载缓慢
- 浏览器卡顿
- PIL 图片大小限制错误

### 解决方案

#### 1. 关键词数量限制
- **默认限制**: 30个关键词
- **可调范围**: 10-50个关键词
- **选择策略**: 自动选择出现频率最高的关键词

#### 2. 图片尺寸优化
- **最大尺寸**: 20×20 英寸
- **DPI**: 100（降低分辨率以减小文件大小）
- **动态调整**: 根据关键词数量自动调整图片大小

#### 3. 显示优化
根据关键词数量自动调整显示参数：

| 关键词数量 | 图片大小 | 标题字号 | 标签字号 | 显示数值 |
|-----------|---------|---------|---------|---------|
| ≤ 20      | 动态    | 16      | 12      | ✅      |
| 21-30     | 动态    | 15      | 11      | ✅      |
| > 30      | 动态    | 14      | 10      | ❌      |

**说明**：
- 当关键词超过30个时，不显示单元格数值，只显示颜色
- 这样可以保持图片清晰度，避免文字重叠

## 使用建议

### 最佳实践

1. **关键词数量**
   - 推荐：20-30个
   - 最小：10个（太少可能看不出规律）
   - 最大：50个（太多会影响可读性）

2. **时间范围**
   - 推荐：1-2年
   - 时间范围太大会导致论文数量过多，关键词过于分散

3. **领域选择**
   - 使用具体的领域关键词
   - 避免过于宽泛的词汇（如"AI"、"计算机"）
   - 推荐使用专业术语（如"量子纠错"、"Transformer模型"）

### 性能指标

#### 处理时间（参考）
- 10个关键词：< 5秒
- 20个关键词：< 10秒
- 30个关键词：< 15秒
- 50个关键词：< 30秒

#### 内存使用
- 10个关键词：~50MB
- 20个关键词：~100MB
- 30个关键词：~150MB
- 50个关键词：~250MB

## 技术细节

### 关键词选择算法

```python
# 1. 统计所有关键词的出现频率
keyword_freq = {}
for keywords in keyword_lists:
    for keyword in keywords:
        keyword_freq[keyword] = keyword_freq.get(keyword, 0) + 1

# 2. 按频率排序
sorted_keywords = sorted(keyword_freq.items(), key=lambda x: x[1], reverse=True)

# 3. 选择前N个
top_keywords = [kw for kw, _ in sorted_keywords[:max_keywords]]
```

### 图片大小计算

```python
# 基础大小：每个关键词0.4英寸
base_size = 0.4
figsize = min(20, max(8, n * base_size))

# 限制最大尺寸为20英寸
# 限制最小尺寸为8英寸
```

### DPI 设置

```python
# 固定DPI为100，降低分辨率
fig, ax = plt.subplots(figsize=(figsize, figsize), dpi=100)
```

## 故障排除

### 错误：Image size exceeds limit

**原因**：PIL 库限制单张图片最大像素数

**解决方案**：
1. 降低"最大关键词数量"设置
2. 系统已自动限制最大尺寸为20×20英寸
3. DPI固定为100

### 错误：内存不足

**原因**：矩阵计算或图片生成占用内存过多

**解决方案**：
1. 减少关键词数量
2. 缩小时间范围
3. 清除缓存后重试

### 图片模糊

**原因**：关键词太多，字体太小

**解决方案**：
1. 减少关键词数量到20-30个
2. 系统会自动调整字体大小
3. 关键词>30时不显示数值，只显示颜色

## 未来优化方向

1. **交互式热力图**
   - 使用 Plotly 替代 matplotlib
   - 支持缩放和悬停显示
   - 更好的大数据支持

2. **分页显示**
   - 将大量关键词分成多个热力图
   - 每页显示20-30个关键词

3. **关键词聚类**
   - 使用聚类算法对关键词分组
   - 只显示每组的代表性关键词

4. **导出功能**
   - 支持导出高分辨率PDF
   - 支持导出原始数据CSV
